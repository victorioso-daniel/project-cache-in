erDiagram
    %% =========================
    %% TABLE DEFINITIONS
    %% =========================

    USER {
        BIGSERIAL id PK
        VARCHAR username
        VARCHAR password_hash
        VARCHAR display_name
    }

    ROLE {
        BIGSERIAL id PK
        VARCHAR name
    }

    PERMISSION {
        BIGSERIAL id PK
        VARCHAR name
    }

    USER_ROLE {
        BIGSERIAL id PK
        BIGINT user_id FK
        BIGINT role_id FK
    }

    ROLE_PERMISSION {
        BIGSERIAL id PK
        BIGINT role_id FK
        BIGINT permission_id FK
    }

    QUIZ_EVENT {
        BIGSERIAL id PK
        VARCHAR title
        BOOLEAN is_active
        TIMESTAMP created_at
        BIGINT created_by FK
    }

    TEAM {
        BIGSERIAL id PK
        VARCHAR name
        VARCHAR access_code
        BIGINT quiz_event_id FK
    }

    QUESTION {
        BIGSERIAL id PK
        BIGINT quiz_event_id FK
        TEXT question_text
        VARCHAR difficulty
        TEXT correct_answer
        INT points
    }

    QUESTION_CHOICE {
        BIGSERIAL id PK
        BIGINT question_id FK
        VARCHAR choice_text
        BOOLEAN is_correct
    }

    SUBMISSION {
        BIGSERIAL id PK
        BIGINT team_id FK
        BIGINT question_id FK
        TEXT answer_text
        BOOLEAN is_correct
        INT points_earned
        TIMESTAMP submitted_at
    }

    EVENT_WINNER {
        BIGSERIAL id PK
        BIGINT team_id FK
        BIGINT quiz_event_id FK
        INT rank
        INT total_score
    }

    %% =========================
    %% RELATIONSHIPS
    %% =========================

    USER ||--o{ USER_ROLE : has
    ROLE ||--o{ USER_ROLE : assigned
    ROLE ||--o{ ROLE_PERMISSION : grants
    PERMISSION ||--o{ ROLE_PERMISSION : belongs
    USER ||--o{ QUIZ_EVENT : creates
    QUIZ_EVENT ||--o{ TEAM : has
    QUIZ_EVENT ||--o{ QUESTION : contains
    QUIZ_EVENT ||--o{ EVENT_WINNER : results
    TEAM ||--o{ SUBMISSION : submits
    TEAM ||--o{ EVENT_WINNER : ranks
    QUESTION ||--o{ QUESTION_CHOICE : choices
    QUESTION ||--o{ SUBMISSION : receives
